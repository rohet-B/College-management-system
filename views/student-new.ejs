<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add New Student</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4">Add New Student</h2>
  <form action="/admin/students" method="POST" class="row g-3">

    <!-- Static Fields -->
    <div class="col-md-6">
      <label for="Full_name" class="form-label">Full Name</label>
      <input type="text" name="Full_name" id="Full_name" class="form-control" required>
    </div>

    <div class="col-md-6">
      <label for="user_name" class="form-label">Username</label>
      <input type="text" name="user_name" id="user_name" class="form-control" required>
    </div>

    <div class="col-md-6">
      <label for="gmail" class="form-label">Gmail</label>
      <input type="email" name="gmail" id="gmail" class="form-control" required oninput="this.value = this.value.toLowerCase()">
    </div>

    <div class="col-md-6">
      <label for="password" class="form-label">Password</label>
      <input type="password" name="password" id="password" class="form-control" required>
    </div>

    <div class="col-md-6">
      <label for="studentID" class="form-label">Student ID</label>
      <input type="text" name="studentID" id="studentID" class="form-control" value="<%= nextID %>" readonly>
    </div>

    <div class="col-md-6">
      <label for="course" class="form-label">Course</label>
      <input type="text" name="course" id="course" class="form-control" required oninput="this.value = this.value.toUpperCase()">
    </div>

    <div class="col-md-6">
      <label for="Year" class="form-label">Year</label>
      <select name="Year" id="Year" class="form-select" required>
        <option value="">-- Select Year --</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="semester" class="form-label">Semester</label>
      <select name="semester" id="semester" class="form-select" required>
        <option value="">-- Select Semester --</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="gender" class="form-label">Gender</label>
      <select name="gender" id="gender" class="form-select" required>
        <option value="">-- Select Gender --</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="dob" class="form-label">Date of Birth</label>
      <input type="date" name="dob" id="dob" class="form-control" required>
    </div>

    <!-- Subject Section -->
    <div class="col-12">
      <h4>Subjects</h4>
      <div id="subjectContainer"></div>
      <button type="button" class="btn btn-secondary mt-2" onclick="addSubject()">+ Add Subject</button>
    </div>

    <!-- Submit Buttons -->
    <div class="col-12">
      <button type="submit" class="btn btn-success">Add Student</button>
      <a href="/admin/students" class="btn btn-secondary ms-2">Cancel</a>
    </div>
  </form>
</div>

<script>
  let subjectCount = 0;
  const defaultAssessments = [
    "PPT Marks", "ASSIGNMENTS 1", "ASSIGNMENTS 2", "ASSIGNMENTS 3",
    "ASSIGNMENTS 4", "Practice Test", "Mock Exam", 
    "Internal Exam (Written)", "Internal Exam (Viva)", "External Exam"
  ];

  function addSubject() {
    const container = document.getElementById("subjectContainer");
    const div = document.createElement("div");
    div.classList.add("border", "rounded", "p-3", "mb-3");

    let html = `
      <div class="mb-2">
        <label>Subject Name</label>
        <input type="text" name="subjects[${subjectCount}][subject]" class="form-control" required oninput="this.value = this.value.toUpperCase()">
      </div>

      <!-- Attendance Defaults -->
      <input type="hidden" name="subjects[${subjectCount}][attendance][present]" value="0">
      <input type="hidden" name="subjects[${subjectCount}][attendance][absent]" value="0">
      <input type="hidden" name="subjects[${subjectCount}][attendance][holiday]" value="0">

      <!-- Assessments -->
      <div><strong>Assessments</strong></div>
    `;

    defaultAssessments.forEach((type, i) => {
      html += `
        <div class="mb-1">
          <label>${type}</label>
          <input type="hidden" name="subjects[${subjectCount}][assessments][${i}][type]" value="${type}">
          <input type="number" class="form-control" value="0" readonly>
          <input type="hidden" name="subjects[${subjectCount}][assessments][${i}][marks]" value="0">
        </div>
      `;
    });

    html += `<button type="button" class="btn btn-danger btn-sm mt-2" onclick="this.parentElement.remove()">Remove Subject</button>`;

    div.innerHTML = html;
    container.appendChild(div);
    subjectCount++;
  }
</script>
</body>
</html>
